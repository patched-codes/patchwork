# Documentation for the `patchwork/steps/PRPB` Module

## Module Overview

The `patchwork/steps/PRPB` module contains the implementation for the PRPB step in the Patchwork workflow. This module primarily includes a class for managing pull request preparation and execution, and associated input and output type definitions.

---

## File: `patchwork/steps/PRPB/PRPB.py`

- **Extension:** `.py`
- **Size:** 1629 bytes
- **Created:** 2024-09-21 04:46:50
- **Modified:** 2024-09-21 04:46:50

### Description

This file defines the `PRPB` class, which extends the `Step` class from the Patchwork framework. The `PRPB` class is configured to handle input and output data through the `PRPBInputs` and `PRPBOutputs` types. It processes modified files and integrates with the `PR` step to manage pull request creation and handling.

### Code Snippet

```python
from patchwork.step import Step
from patchwork.steps import PR
from patchwork.steps.PRPB.typed import PRPBInputs, PRPBOutputs


class PRPB(Step, input_class=PRPBInputs, output_class=PRPBOutputs):
    def __init__(self, inputs):
        super().__init__(inputs)
        key_map = dict(path=inputs["path_key"])
        if inputs.get("title_key") is not None:
            key_map["commit_message"] = inputs["comment_title_key"]
        if inputs.get("message_key") is not None:
            key_map["patch_message"] = inputs["comment_message_key"]

        self.modified_files = []
        input_modified_files = inputs.get("modified_files")
        if isinstance(input_modified_files, list):
            for modified_file in input_modified_files:
                converted_modified_file = {key: modified_file.get(mapped_key) for key, mapped_key in key_map.items()}
                if converted_modified_file.get("path") is None:
                    continue
                self.modified_files.append(converted_modified_file)
        elif isinstance(input_modified_files, dict):
            converted_modified_file = {key: input_modified_files.get(mapped_key) for key, mapped_key in key_map.items()}
            self.modified_files.append(converted_modified_file)
        elif isinstance(input_modified_files, str):
            converted_modified_file = {"path": input_modified_files}
            self.modified_files.append(converted_modified_file)
        self.inputs = inputs

    def run(self):
        pr = PR({**self.inputs, "modified_code_files": self.modified_files})
        pr_outputs = pr.run()

        return pr_outputs
```

### Inputs

- **`inputs`**: A dictionary containing the input parameters required for the step, primarily:
  - **`path_key, comment_title_key, comment_message_key`**: Strings for mapping input keys to internal representation.
  - **`modified_files`**: List or dict of modified files to be handled.

### Outputs

- The method `run()` returns a dictionary containing outputs generated by the `PR` step, including URL and details of the created pull request.

---

## File: `patchwork/steps/PRPB/typed.py`

- **Extension:** `.py`
- **Size:** 1348 bytes
- **Created:** 2024-09-21 04:46:50
- **Modified:** 2024-09-21 04:46:50

### Description

This file defines the types `PRPBInputs` and `PRPBOutputs` which specify the structure of the input and output data for the `PRPB` class. It uses Python's `TypedDict` for type enforcement and `Annotated` to add configuration metadata.

### Code Snippet

```python
from typing_extensions import Annotated, Dict, List, TypedDict
from patchwork.common.utils.step_typing import StepTypeConfig

class __PRPBInputsRequired(TypedDict):
    modified_files: List[Dict]
    path_key: str

class PRPBInputs(__PRPBInputsRequired, total=False):
    comment_title_key: str
    comment_message_key: str
    disable_branch: Annotated[bool, StepTypeConfig(is_config=True)]
    force_branch_creation: Annotated[bool, StepTypeConfig(is_config=True)]
    branch_prefix: Annotated[str, StepTypeConfig(is_config=True)]
    branch_suffix: Annotated[str, StepTypeConfig(is_config=True)]
    pr_header: Annotated[str, StepTypeConfig(is_config=True)]
    pr_title: Annotated[str, StepTypeConfig(is_config=True)]
    force_pr_creation: Annotated[bool, StepTypeConfig(is_config=True)]
    disable_pr: Annotated[bool, StepTypeConfig(is_config=True)]
    scm_url: Annotated[str, StepTypeConfig(is_config=True)]
    gitlab_api_key: Annotated[str, StepTypeConfig(is_config=True)]
    github_api_key: Annotated[str, StepTypeConfig(is_config=True)]

class PRPBOutputs(TypedDict):
    base_branch: str
    target_branch: str
    pr_body: str
    pr_url: str
```

### Inputs

- **`PRPBInputs`**: This type dict specifies the required and optional input fields for the PRPB step, which includes:
  - Required: `modified_files`, `path_key`
  - Optional: Various configuration settings related to branches and pull requests.

### Outputs

- **`PRPBOutputs`**: This type dict specifies the expected output fields from the PRPB step, including:
  - `base_branch`
  - `target_branch`
  - `pr_body`
  - `pr_url`

---

## File: `patchwork/steps/PRPB/__init__.py`

- **Extension:** `.py`
- **Size:** 0 bytes
- **Created:** 2024-09-21 04:46:50
- **Modified:** 2024-09-21 04:46:50

### Description

This is an empty initialization file to mark the directory as a Python package.

### Code Snippet

```python

```

---

The `patchwork/steps/PRPB` module is designed to handle the preparation and execution of pull requests as part of a Patchwork workflow. It integrates with other parts of the Patchwork framework to manage input and output data types, and to conduct actions required for creating pull requests. The implementation makes use of Python's `TypedDict` for structured input/output specifications and leverages inheritance for step management and execution.